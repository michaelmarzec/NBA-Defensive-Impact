## michael marzec ##

# look viable for 5 seasons: https://www.nba.com/stats/articles/nba-com-stats-unveils-improved-matchup-data-for-2019-20-season/

##################################################################################################################################

##### nba_playerID_scrape.py #####
import pandas as pd
import numpy as np
from nba_api.stats.endpoints.commonallplayers import CommonAllPlayers

### Obtain active player IDs via NBA_API ####
# output_list = CommonAllPlayers(season='2017-18').get_data_frames()
# df = pd.DataFrame(output_list[0])
# active_df = df[df.ROSTERSTATUS==1].reset_index(drop=True)
# active_ids = active_df.PERSON_ID.tolist()



##########################################################################################

###### captured player ids #######

# player_id_2020_21 = [1630173, 203500, 1628389, 1630234, 1629638, 1628960, 1628386, 202329, 203937, 203507, 1628961, 203648, 2546, 1630175, 1628384, 1627853, 2772, 201571, 1630166, 1629028, 1628962, 1628407, 1628963, 1630163, 1628366, 1628964, 1630217, 203084, 1629628, 203115, 1628966, 201587, 203382, 203145, 1629647, 203078, 1627736, 1628395, 1627761, 202722, 201976, 1630180, 1630189, 203920, 1629048, 202687, 202357, 202339, 1629833, 203992, 202711, 1629626, 1629067, 1626164, 1628449, 202340, 1628396, 1629714, 1629649, 1628969, 1628970, 1628578, 1629052, 1627763, 1629717, 1628415, 1628971, 1627759, 1629650, 1628425, 1629718, 1628972, 1628973, 1629091, 1628418, 203493, 203504, 202692, 202710, 1629719, 203484, 1630267, 1628427, 203991, 1630176, 1628975, 1628976, 203487, 1627936, 1626161, 1629185, 1629109, 1629634, 203903, 1629651, 1629599, 1628381, 1628380, 201144, 1626192, 1629076, 202326, 203496, 1628470, 203109, 1629633, 203552, 201939, 1630268, 203076, 202334, 1629056, 201942, 1630466, 203473, 203521, 1628978, 1629603, 1628977, 203476, 203915, 1629029, 1629652, 1628422, 1629653, 1629635, 1628408, 201609, 203083, 201162, 1627739, 201142, 1630162, 1629035, 1629604, 201961, 203954, 203516, 1629234, 203957, 1629605, 202324, 1626245, 1628981, 1627812, 1627827, 1630201, 1627854, 1630235, 203095, 1628368, 204025, 1628365, 1629117, 1629655, 201568, 204038, 1629636, 201188, 200752, 202331, 201959, 1628385, 1628983, 1630264, 1630273, 203497, 1629164, 203932, 201569, 1628984, 203924, 201980, 203110, 203210, 1629750, 201145, 1630182, 201933, 1629657, 1629060, 1630169, 1630221, 1630181, 203501, 201935, 203090, 1629607, 1626149, 203914, 203925, 202699, 1627885, 1628404, 1628392, 2617, 1629637, 1630165, 202330, 1627823, 1626195, 1629639, 1627741, 201588, 203524, 1630207, 1629658, 1628988, 201950, 203200, 1626178, 1626158, 1630258, 203918, 201143, 1629659, 1627863, 2730, 1630210, 1628989, 1630190, 1629631, 1628990, 201586, 2738, 101141, 204060, 1627742, 202681, 1628371, 1628411, 1628402, 1628367, 1628382, 202704, 1628991, 1629713, 2544, 1628455, 1629610, 1629660, 1630198, 1628993, 1629661, 201949, 1629640, 1626169, 204020, 203999, 1627745, 1630200, 1626145, 1627884, 201599, 202709, 1629662, 1626163, 202683, 1628379, 1629663, 1628467, 1630233, 1628995, 1629723, 1627788, 1628436, 1628398, 203897, 1630237, 203087, 1629641, 1627774, 1627747, 1628388, 1627814, 1630240, 203458, 202695, 1630184, 203081, 1629642, 1626172, 201572, 201577, 1629712, 201567, 200768, 1627789, 1626168, 1630177, 1629611, 1630185, 1626246, 1628374, 1630230, 1628997, 1628998, 1629725, 1630231, 1629103, 1629726, 202083, 1630178, 1630219, 203468, 204456, 1630183, 1629667, 203926, 1630253, 201580, 203585, 1628035, 1629162, 203463, 1629740, 1629001, 1630241, 1629002, 203114, 201988, 200794, 1629003, 1628378, 1629690, 1628370, 202734, 1629630, 1629752, 202693, 1628420, 202694, 1628539, 1627749, 1627750, 203488, 1629004, 1627846, 1626204, 1630174, 203526, 1627777, 1630192, 203457, 1629669, 1628373, 1629134, 203263, 203994, 1628021, 1629670, 1626220, 1628400, 1626143, 1629643, 1629006, 1630168, 1630171, 1629644, 203506, 203482, 1629671, 1626224, 1630187, 1626162, 203953, 1629672, 202335, 101108, 1626166, 203901, 1627780, 203658, 1629617, 1629033, 203486, 1627751, 1630197, 1629673, 1629007, 1629645, 1629008, 203490, 1626171, 204001, 203939, 1626181, 1627752, 1630202, 1630193, 1630186, 1626184, 203944, 1629629, 200755, 1630194, 1629675, 1630208, 1626196, 1630203, 203085, 1629130, 1629011, 1629676, 200765, 201565, 203082, 1626179, 201937, 1626156, 1627734, 1629677, 203960, 203967, 203107, 203471, 203118, 1630206, 1629012, 1629013, 1627783, 1627732, 1629014, 1629686, 1629346, 203935, 202397, 1630188, 1628372, 203503, 1630199, 1630205, 1630191, 1629622, 1628410, 1630256, 1628369, 201952, 202066, 1630179, 1628464, 1630271, 1629017, 1629744, 202691, 202684, 1628414, 1629680, 1629681, 1630214, 201229, 1630167, 1629308, 1626253, 1626157, 1629018, 200782, 1629730, 1626167, 202685, 1627756, 1627832, 1629020, 1630170, 1630492, 1629216, 202696, 1629731, 1629021, 202689, 1629022, 202322, 202954, 203933, 1629023, 1629139, 1629682, 1628778, 1629683, 201566, 1629632, 1628401, 202355, 203952, 1629684, 1629026, 101150, 1630172, 1629057, 1629627, 1628391, 1629685, 1626159, 1630216, 1630164, 1626174, 1630218, 1626153, 201152, 1629027, 1630209, 203469, 1627826]
# player_id_2019_20 = [1629121, 203500, 1628389, 200746, 1629734, 1629638, 1628960, 1628386, 202329, 1626147, 203937, 203507, 1628961, 203648, 2546, 1628384, 1627853, 2772, 201571, 1629028, 1628407, 1628963, 1628366, 1628964, 200826, 203084, 1629628, 203115, 1628966, 201587, 203382, 203145, 1629647, 203078, 1627736, 201158, 1628395, 1627761, 202722, 201976, 203920, 1629048, 202687, 202357, 202339, 203992, 202711, 1629626, 1629648, 1629067, 1626164, 1628449, 1628968, 1629065, 202340, 1628396, 1629714, 1629649, 201147, 1628969, 1628970, 1629052, 1629151, 1627763, 1628415, 1628971, 1627759, 1629650, 1628425, 1629718, 1628972, 1628973, 1628418, 203493, 203504, 202692, 1629126, 202710, 203998, 1629719, 203484, 1628427, 203991, 201960, 1628975, 1713, 1628976, 203487, 1627936, 1626161, 2199, 201163, 1629597, 1629185, 1627737, 1629109, 1629634, 203903, 1629651, 1629598, 1628499, 1629599, 1628381, 1628380, 201144, 1626192, 1626188, 1629076, 203496, 1628470, 2037, 203109, 1629633, 203552, 201939, 203584, 203076, 202334, 1629056, 201942, 203473, 203521, 1628978, 1627767, 1628977, 203476, 203915, 1629029, 1629652, 1628422, 1629635, 1628408, 201609, 203083, 201162, 1627739, 201142, 1629035, 201961, 203954, 203516, 1629234, 1628980, 203957, 1629605, 202324, 1626245, 1628390, 1628981, 1627812, 1627827, 1627854, 203095, 1628368, 1628982, 1626187, 1628365, 1629117, 1629655, 201568, 204038, 1629636, 201188, 200752, 202331, 201959, 1628385, 1628983, 203497, 1629164, 203932, 201569, 1628984, 1626203, 203924, 1626170, 1627982, 201980, 203110, 203210, 1629750, 201145, 201933, 1629741, 1629657, 1629060, 1628985, 1629743, 203501, 201935, 203090, 1629607, 1626149, 203914, 203925, 202699, 1627885, 1628404, 2617, 1629637, 202330, 203089, 1629608, 1627823, 1626195, 1629639, 1628987, 1626209, 1627741, 201588, 203524, 1629658, 1628988, 201950, 203200, 1626178, 1626158, 203918, 201143, 1629659, 1627863, 2730, 1629739, 1628989, 1629631, 1628990, 201586, 2738, 101141, 204060, 1627742, 202681, 1628371, 1628411, 1628402, 1628367, 1628382, 202704, 1628991, 1629713, 2544, 1629610, 1629660, 1628993, 1629168, 1629661, 201949, 1629640, 1626169, 204020, 203999, 1627745, 1626145, 1627884, 201599, 202709, 1629662, 1626163, 202683, 1628379, 203077, 1629663, 1628467, 202688, 1628995, 1629723, 1627788, 1628436, 2594, 1629066, 1628398, 203897, 1627746, 203087, 1629641, 1629724, 1627774, 1627747, 1628388, 1629665, 201584, 1627814, 203458, 202695, 203086, 203081, 1629642, 1626172, 201572, 201577, 201567, 200768, 1627789, 1626168, 101133, 1627748, 1629611, 1626246, 1628374, 1628997, 1628998, 1629725, 1629103, 1628412, 1629726, 202083, 201601, 1627775, 203468, 204456, 1629667, 203926, 201580, 203585, 1628035, 1629162, 203463, 203895, 1629740, 1629001, 1629002, 203114, 203121, 1626259, 201988, 200794, 1629003, 1628378, 1628513, 1629690, 1628370, 1629760, 202734, 1629630, 1629752, 202693, 1628420, 202694, 1628405, 1626144, 1628539, 1627749, 1627750, 1629058, 203488, 1629004, 1627846, 1626204, 203894, 203526, 1627777, 201149, 203457, 1629669, 1628373, 1629134, 203994, 1628021, 1626220, 203124, 1628400, 1626143, 1629059, 1629006, 1629644, 203506, 203482, 1629671, 1626224, 1626162, 1629745, 203953, 1629672, 1628394, 202335, 1628383, 101108, 1626166, 203901, 1627780, 203658, 1629033, 203486, 1627751, 1629738, 1629673, 1629007, 1629645, 1629008, 203490, 1626171, 204001, 203939, 1626181, 1627752, 203944, 1629729, 1629629, 200755, 1629675, 1629244, 1626196, 203085, 203460, 1629130, 1629010, 1629011, 203922, 1629676, 200765, 201565, 203082, 1626179, 201937, 1626156, 1627734, 1629677, 203960, 203967, 203107, 1629678, 203471, 203118, 200757, 1629012, 1629013, 1629621, 1627783, 1629735, 1627732, 1628424, 1629014, 1629346, 203935, 202397, 2747, 1629015, 1628372, 203503, 1629034, 1629016, 1629622, 1628410, 1628403, 1628369, 201952, 202066, 1628464, 1629017, 202498, 1629744, 202691, 202684, 1628414, 1629680, 201229, 1629308, 1626157, 1629018, 200782, 1629730, 202323, 1626167, 1627784, 202685, 1627756, 1627832, 1629020, 1629216, 203943, 202696, 1629731, 1629021, 203079, 202689, 1629022, 202322, 202954, 203933, 1629023, 1629139, 1629682, 1628778, 1629683, 201566, 1629632, 1628401, 202355, 203952, 1629684, 1629140, 1629026, 101150, 101107, 1629057, 1628430, 1629627, 1628391, 1629685, 1626159, 1626174, 1629624, 1626153, 1629625, 201152, 1629027, 203469, 203092, 1627790, 1627826]
# player_id_2018_19 = [1629121, 203500, 1628389, 1629061, 200746, 1628959, 1628960, 1628386, 1628443, 202329, 1626147, 203937, 201583, 203507, 1628961, 1628384, 1627853, 2772, 201571, 1629028, 1628407, 1628963, 1628366, 1628964, 200826, 203084, 203115, 1628966, 201587, 201573, 203382, 203145, 203078, 1627736, 201158, 1628395, 1627761, 1627733, 1629541, 202722, 201976, 203920, 202687, 202357, 1628469, 202339, 1628417, 1629129, 203992, 202711, 101106, 1628413, 1629067, 1626164, 1628449, 202340, 1628396, 201147, 1628969, 1628970, 1629151, 1627763, 1628415, 1628971, 1627759, 1628425, 1628972, 1628973, 1628418, 203493, 203504, 202692, 1629126, 202710, 203998, 101181, 203484, 203991, 201960, 1628975, 1713, 1628976, 203487, 1627936, 1626161, 1628505, 1628463, 2199, 201163, 1629147, 1629185, 1627737, 1629109, 203546, 203903, 1628381, 1628380, 201954, 1629045, 201144, 1626192, 1626188, 202326, 203496, 203459, 1628470, 2037, 1628249, 203109, 201967, 203552, 201939, 203584, 203076, 202334, 201942, 203473, 1626155, 1629116, 203521, 2736, 1629094, 1628978, 1627767, 1628977, 203476, 203915, 1629029, 1628416, 1628422, 1628408, 201609, 203083, 201162, 1627739, 201142, 1628979, 1629053, 1627740, 201961, 203954, 203516, 1629234, 1628980, 1628393, 203957, 202702, 202324, 1626245, 101109, 1628390, 1627812, 1627827, 1627854, 203095, 1628368, 1628982, 204025, 1626187, 202690, 101112, 1628365, 1629117, 201568, 204038, 1628656, 201188, 2200, 200752, 202331, 1626780, 201959, 1628385, 1628983, 203497, 1629164, 203932, 201569, 1628984, 1626203, 203924, 1626170, 1629055, 201980, 203110, 101123, 203210, 201145, 201933, 203501, 201935, 203090, 1626149, 2734, 203914, 203925, 202699, 1627885, 1628404, 1628392, 2617, 202330, 203089, 1627823, 1626195, 1626209, 1628439, 1627741, 1629312, 2403, 201588, 203524, 1628988, 201950, 203200, 1626178, 1626158, 203918, 201143, 1627863, 2730, 1628989, 1629353, 1626154, 1628990, 201586, 2738, 101141, 204060, 1627742, 202681, 1628371, 1628411, 1628402, 1628367, 1628382, 202704, 1628991, 2544, 1628518, 203098, 201973, 1628993, 101161, 1629168, 201949, 1626169, 204020, 202325, 203999, 1627745, 1629203, 1626145, 1627884, 201599, 202709, 1626163, 202683, 1628379, 203077, 1628994, 1628467, 202688, 1628995, 1627788, 1628436, 2594, 201585, 1629066, 1628398, 203897, 1627746, 203087, 1627774, 1627747, 1628388, 201584, 1627814, 1627215, 203458, 202695, 203086, 202720, 203081, 202391, 2733, 1626172, 201572, 201577, 201567, 200768, 1628070, 203564, 1627789, 1628399, 1626168, 202714, 1629133, 1629122, 101133, 1627748, 1626246, 1628374, 1626185, 1628412, 1628999, 202083, 1627775, 203468, 204456, 203926, 201580, 203585, 1628035, 203895, 201975, 1626257, 1629001, 1629002, 203114, 101139, 203121, 1626259, 201988, 200794, 1629003, 202703, 1628378, 1628513, 1628370, 202328, 1628500, 202734, 203961, 202693, 1628420, 202694, 202700, 1628405, 202389, 1626144, 1627749, 1627750, 1629058, 203488, 1629004, 1627846, 1626204, 203894, 203526, 1627777, 201149, 203457, 1717, 1628373, 1629134, 203994, 1628021, 1626220, 203124, 1628400, 1626143, 1629059, 1629006, 203506, 203482, 1626224, 1626162, 2585, 203953, 2225, 202718, 202335, 101108, 203901, 1629341, 1629033, 203486, 203101, 1627751, 202347, 1629008, 203490, 1626171, 204001, 203939, 1626181, 1627816, 1627752, 1628397, 1626184, 203944, 200755, 1628432, 1629244, 1626196, 203085, 203460, 1628421, 1629130, 1629010, 1629011, 203922, 200765, 201565, 203082, 1626179, 201937, 1626156, 1627734, 1629102, 203967, 203107, 203471, 203118, 200757, 1627782, 1629012, 1629013, 202697, 1627783, 1627732, 203613, 1629014, 203935, 202397, 2747, 1629015, 1628372, 203503, 1629034, 1629016, 203917, 202362, 1628410, 1628403, 1628369, 201952, 202066, 1629123, 1628464, 202738, 1629017, 202498, 202691, 202684, 1628414, 201229, 1626157, 1629018, 1629019, 200782, 202323, 1626167, 202327, 202685, 1627756, 1627832, 1629020, 203943, 202696, 2548, 1629021, 203079, 202689, 1629022, 202322, 1627820, 202954, 203933, 1627395, 1629139, 1629118, 201566, 1628401, 1627785, 202355, 203952, 1626210, 203710, 1629140, 1629026, 101150, 101107, 1627786, 1629057, 1628391, 1626159, 1626174, 1626153, 1627824, 201152, 1629027, 203469, 203092, 1627790, 1627826]
player_id_2017_18 = [203518, 203112, 203500, 1628389, 201167, 201582, 202332, 200746, 1628386, 1628443, 202329, 1626147, 203937, 201583, 1628387, 203507, 2546, 1628384, 1627853, 2772, 201589, 1628503, 201600, 201571, 202337, 1628407, 1627758, 1627735, 1628366, 200826, 203084, 203115, 201587, 201573, 203382, 203145, 203078, 1627736, 201563, 201158, 1628395, 1627761, 1627733, 202722, 201976, 203920, 1628444, 202687, 202357, 204028, 1628469, 202339, 203992, 202711, 1626164, 202344, 202340, 1628396, 201147, 1627763, 201166, 1628415, 202705, 1626148, 1627759, 203485, 203900, 1628425, 1628418, 203493, 203504, 202692, 202710, 202779, 203998, 101181, 203484, 203991, 201960, 1713, 203487, 1627936, 1626161, 1628463, 201596, 2199, 201163, 1627737, 203546, 203903, 1628499, 1628381, 1628380, 1627858, 201954, 2555, 201144, 1626192, 1626188, 1628429, 204022, 1627856, 202326, 203496, 203459, 1628470, 2037, 202348, 203109, 201967, 203552, 201939, 203584, 203076, 1627738, 202334, 201942, 203473, 1626155, 1627098, 203521, 2736, 1627767, 203476, 203915, 1628416, 1628422, 1628495, 1628408, 201609, 203580, 203083, 201162, 1627739, 201142, 204067, 1627740, 201961, 203954, 203898, 203516, 1628393, 202379, 201936, 203957, 202702, 202324, 1627770, 1626245, 101109, 1628390, 1627812, 1627827, 1627854, 203095, 1628368, 204025, 101112, 1628365, 201568, 204038, 201188, 2200, 200752, 202331, 1627875, 1626780, 201959, 1628385, 1938, 203497, 203932, 201569, 101162, 1626203, 203924, 1626170, 201980, 203110, 101123, 203210, 201145, 201933, 1627772, 203501, 201935, 203090, 1626149, 2734, 203914, 203925, 202699, 1626151, 1626150, 1627885, 1628404, 2617, 1628502, 202330, 203687, 1627988, 203089, 1627823, 1626195, 1626209, 1628439, 1627741, 2403, 201588, 203524, 1626199, 201950, 203200, 1626178, 1626158, 203918, 201143, 1627863, 2730, 203962, 1626154, 201586, 2738, 101141, 204060, 201281, 1627742, 202681, 1628371, 1628411, 101127, 1628935, 1627743, 1628402, 1628367, 1628382, 202704, 2544, 2744, 1628518, 2210, 201943, 201973, 101161, 1626177, 201949, 2207, 1626169, 204020, 202325, 203999, 1627745, 1627883, 1626145, 1627884, 201599, 202709, 1626163, 202683, 1628379, 203077, 203930, 1628467, 202688, 1627788, 1628436, 2594, 201585, 1628398, 203897, 1627746, 203087, 203499, 203530, 201951, 1627774, 1627747, 1628388, 201584, 1627814, 203458, 202695, 203086, 202720, 202732, 203081, 202391, 2733, 1626172, 201572, 201577, 201567, 200768, 1627789, 1628399, 1626168, 203705, 101133, 1627748, 1626246, 1628374, 1626185, 1628412, 1628493, 202083, 201601, 1627775, 203468, 204456, 1628571, 1626191, 203926, 201580, 203585, 1628035, 203463, 201975, 1626257, 1626175, 203114, 101139, 203121, 1626259, 201988, 200794, 202703, 1628378, 1628370, 202328, 1628500, 202734, 203961, 1628537, 202693, 1628420, 202694, 1628405, 202389, 1626144, 203498, 204098, 1627749, 1627750, 203488, 1627846, 1626204, 203894, 2749, 203526, 1627777, 201149, 203457, 203512, 1717, 1628373, 203994, 1628021, 1626220, 203124, 1628400, 2731, 1626143, 203506, 203482, 1627778, 1626224, 1626162, 2585, 1627779, 1627834, 203953, 2225, 202718, 202335, 1628383, 203464, 101108, 1626166, 203901, 1627780, 2570, 1628409, 1627850, 203486, 203101, 1627751, 203490, 1626171, 204001, 203939, 1626181, 1627816, 1627752, 1628681, 1627753, 1628397, 203944, 2216, 200755, 1628432, 1626196, 1627781, 203085, 203460, 1628421, 203922, 200765, 201565, 203082, 1626179, 201937, 1626156, 1627734, 203960, 203967, 203107, 203471, 203118, 200757, 1627782, 201196, 202697, 1627783, 202918, 1627732, 203613, 1628424, 202713, 203935, 202397, 2747, 201160, 1628372, 203503, 201578, 203917, 202362, 204065, 202933, 1628410, 1628403, 1628369, 1627819, 201952, 203104, 202066, 1628462, 1891, 1628464, 202738, 202498, 202691, 202684, 1628414, 201229, 1626157, 200782, 202323, 1626167, 202327, 1627755, 202685, 1627756, 1627832, 203943, 202696, 2548, 203079, 202689, 202322, 1627820, 1628476, 203933, 204037, 1627821, 1627362, 2561, 201566, 1628401, 1627855, 1628510, 1627785, 202355, 203952, 203912, 1626210, 203710, 101150, 101107, 1627786, 1628391, 1626159, 1626153, 1627824, 1626202, 201156, 201152, 203469, 203092, 1627835, 1627790, 1627826]

################################################################################################

import requests
from csv import DictWriter

def get_matchups(player_id):

    import requests

    url = "https://stats.nba.com/stats/leagueseasonmatchups"

    params = {
        "DateFrom": "",
        "DateTo": "",
        "DefPlayerID": player_id,#"203081",
        # "OffPlayerID": player_id, #enable for offensive oriented request
        "LeagueID": "00",
        "Outcome": "",
        "PORound": "0",
        "PerMode": "Totals",
        "Season": "2016-17",
        "SeasonType": "Regular Season"
    }

    headers = {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Referer": "https://www.nba.com/",
        "User-Agent": "Mozilla/5.0",
        "x-nba-stats-origin": "stats",
        "x-nba-stats-token": "true"
    }

    print("Getting matchups for player ID# {}...".format(params["DefPlayerID"]))
    # print("Getting matchups for player ID# {}...".format(params["OffPlayerID"])) # If extracting for offensive, rather than defense

    response = requests.get(url, params=params, headers=headers)
    response.raise_for_status()

    data = response.json()
    
    fieldnames = data["resultSets"][0]["headers"]

    for row in data["resultSets"][0]["rowSet"]:
        yield dict(zip(fieldnames, row))

def main():

    # dame_id = '203081'
    # ant_id = '1630162'
    print("Writing to CSV file...")
    for pl_id in player_id_2017_18:

        all_matchups = list(get_matchups(pl_id))

        with open("output.csv", "a", newline="") as file:
            try:
                fieldnames = list(all_matchups[0]) 
                writer = DictWriter(file, fieldnames=fieldnames)

                writer.writeheader()
                for matchup in all_matchups:
                    writer.writerow(matchup)
            except:
                pass

        print("Done.")



if __name__ == "__main__":
    main()